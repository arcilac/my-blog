<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/my-blog/_next/static/css/83cc0ea6f102b864.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/my-blog/_next/static/css/a494df4e6249897d.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/my-blog/_next/static/chunks/webpack-e4b2ba0bd574cac0.js" crossorigin=""/><script src="/my-blog/_next/static/chunks/fd9d1056-8eeb8092ef3d3dd5.js" async="" crossorigin=""></script><script src="/my-blog/_next/static/chunks/938-84fed2705efa299b.js" async="" crossorigin=""></script><script src="/my-blog/_next/static/chunks/main-app-f4d94776ad940ad5.js" async="" crossorigin=""></script><script src="/my-blog/_next/static/chunks/250-f66e98452b80d3d3.js" async=""></script><script src="/my-blog/_next/static/chunks/app/layout-b80959e2834ced79.js" async=""></script><script src="/my-blog/_next/static/chunks/644-4de71cea8aeaed79.js" async=""></script><script src="/my-blog/_next/static/chunks/852-215445fe88778aae.js" async=""></script><script src="/my-blog/_next/static/chunks/app/blog/%5Bslug%5D/page-fab3f594c1476cf4.js" async=""></script><link rel="icon" href="/favicon.ico"/><title>Blog</title><meta name="description" content="A personal blog connected with Notion"/><link rel="icon" href="/my-blog/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/my-blog/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="bg-black text-white min-h-screen flex flex-col"><div class="flex flex-col min-h-screen"><header class="navbar"><div class="navbar-container"><a class="navbar-logo" href="/my-blog/">Cami&#x27;s Blog</a><nav class="navbar-nav hidden md:flex"><a class="navbar-link" href="/my-blog/">Home</a><a class="navbar-link" href="/my-blog/blog/">Blog</a><a class="navbar-link" href="https://arcilac.github.io/portfolio/">Contact</a></nav><div class="flex items-center gap-4"></div></div></header><div class="flex-grow"><main class="post-container"><article class="post-article"><h1 class="post-title">Node.js Clustering and Load Balancing</h1><div class="post-content"><div class="notion-content" style="color:var(--foreground)"><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">What Is Clustering in Node.js?</h2><p style="margin-bottom:1rem;line-height:1.7">Node.js runs on a <strong>single thread</strong>, which means it can only use one CPU core by default. Clustering allows you to <strong>spawn multiple instances</strong> of your application, each running on its own CPU core. These instances, or “workers,” can handle requests in parallel, significantly improving throughput and availability.</p><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">How Does Clustering Work?</h2><p style="margin-bottom:1rem;line-height:1.7">Node.js provides a built-in <code class="inline-code">cluster</code> module. A <strong>master process</strong> manages several <strong>worker processes</strong>, each with its own event loop. When a request comes in, it’s distributed among the workers.</p><h3 style="font-size:1.25rem;font-weight:bold;margin-top:1.5rem;margin-bottom:0.75rem">Basic Clustering Example</h3><div style="margin-bottom:1.5rem;margin-top:1.5rem"><pre style="color:#d4d4d4;font-size:0.9rem;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:.5em 0;overflow:auto;background:#1e1e1e;border-radius:0.5rem;background-color:#1E1E1E"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#569CD6">const</span><span> cluster </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;cluster&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#569CD6">const</span><span> http </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;http&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#569CD6">const</span><span> os </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;os&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>cluster</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">isPrimary</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">const</span><span> numCPUs </span><span class="token" style="color:#d4d4d4">=</span><span> os</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">cpus</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">length</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Master </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">process</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">pid</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> is running</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#6a9955">// Fork workers.</span><span>
</span><span>  </span><span class="token" style="color:#c586c0">for</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">let</span><span> i </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">;</span><span> i </span><span class="token" style="color:#d4d4d4">&lt;</span><span> numCPUs</span><span class="token" style="color:#d4d4d4">;</span><span> i</span><span class="token" style="color:#d4d4d4">++</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    cluster</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">fork</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#6a9955">// Optional: Restart worker on exit</span><span>
</span><span>  cluster</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">on</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;exit&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>worker</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Worker </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">worker</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">process</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">pid</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> died. Restarting...</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    cluster</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">fork</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#c586c0">else</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  http</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">createServer</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span>req</span><span class="token" style="color:#d4d4d4">,</span><span> res</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">=&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    res</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">end</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Handled by worker </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">process</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">pid</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">listen</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">3000</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#4ec9b0">console</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">log</span><span class="token" style="color:#d4d4d4">(</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token template-string" style="color:#ce9178">Worker </span><span class="token template-string" style="color:#569cd6">${</span><span class="token template-string" style="color:#9cdcfe">process</span><span class="token template-string" style="color:#d4d4d4">.</span><span class="token template-string property-access" style="color:#9cdcfe">pid</span><span class="token template-string" style="color:#569cd6">}</span><span class="token template-string" style="color:#ce9178"> started</span><span class="token template-string template-punctuation" style="color:#ce9178">`</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
</code></pre></div><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Why Use Clustering?</h2><div style="margin-bottom:1.5rem;overflow-x:auto"><table style="width:100%;border-collapse:collapse"><tbody><tr><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:1px solid var(--border)">Benefit</td><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:none">Explanation</td></tr><tr></tr><tr><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:1px solid var(--border)">Performance</td><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:none">Leverages multi-core systems to handle more requests</td></tr><tr><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:1px solid var(--border)">Fault tolerance</td><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:none">If a worker crashes, others continue to serve requests</td></tr><tr><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:1px solid var(--border)">Scalability</td><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:none">Can scale apps horizontally by running more processes</td></tr><tr><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:1px solid var(--border)">Simple setup</td><td style="padding:0.75rem;border-bottom:1px solid var(--border);border-right:none">Requires minimal changes to existing Node.js apps</td></tr></tbody></table></div><hr style="border:none;height:1px;background-color:var(--border);margin:2rem 0"/><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Load Balancing Concepts</h2><p style="margin-bottom:1rem;line-height:1.7">Clustering distributes load <strong>within a single machine</strong>, but to handle <strong>higher traffic or redundancy</strong>, you may need <strong>external load balancing</strong>:</p><h3 style="font-size:1.25rem;font-weight:bold;margin-top:1.5rem;margin-bottom:0.75rem">Common Load Balancing Methods:</h3><ul style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:disc"><li style="margin-bottom:0.5rem"><strong>Round-robin:</strong> Requests are distributed evenly across instances</li><li style="margin-bottom:0.5rem"><strong>Least connections:</strong> Directs traffic to the server with the fewest active connections</li><li style="margin-bottom:0.5rem"><strong>Sticky sessions:</strong> Ensures a user stays connected to the same worker or server</li></ul><h3 style="font-size:1.25rem;font-weight:bold;margin-top:1.5rem;margin-bottom:0.75rem">Load Balancing Tools:</h3><ul style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:disc"><li style="margin-bottom:0.5rem"><strong>Nginx</strong> or <strong>HAProxy</strong>: Can sit in front of clustered Node.js servers</li><li style="margin-bottom:0.5rem"><strong>PM2</strong>: A Node.js process manager that supports clustering and load balancing</li><li style="margin-bottom:0.5rem"><strong>Cloud load balancers</strong>: Offered by AWS, GCP, Azure, etc.</li></ul><hr style="border:none;height:1px;background-color:var(--border);margin:2rem 0"/><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Combining Clustering with Load Balancing</h2><p style="margin-bottom:1rem;line-height:1.7">You can combine both strategies for maximum performance:</p><ul style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:disc"><li style="margin-bottom:0.5rem">Use <strong>Node.js clustering</strong> to utilize all cores of each server</li><li style="margin-bottom:0.5rem">Use a <strong>reverse proxy</strong> like <strong>Nginx</strong> to distribute load across multiple servers</li></ul><hr style="border:none;height:1px;background-color:var(--border);margin:2rem 0"/><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Best Practices</h2><ul style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:disc"><li style="margin-bottom:0.5rem">Always monitor worker health and restart on failure</li><li style="margin-bottom:0.5rem">Share minimal state between workers (use external storage like Redis if needed)</li><li style="margin-bottom:0.5rem">Use sticky sessions if your app relies on session-based auth</li><li style="margin-bottom:0.5rem">Avoid memory leaks — they’ll affect all workers over time</li><li style="margin-bottom:0.5rem">Test under load to determine ideal number of workers</li></ul><hr style="border:none;height:1px;background-color:var(--border);margin:2rem 0"/><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Conclusion</h2><p style="margin-bottom:1rem;line-height:1.7">Clustering and load balancing are essential for scaling Node.js applications effectively. By leveraging multiple CPU cores and distributing traffic smartly, you can handle more users, increase resilience, and build faster, more reliable backends.</p></div></div><div class="post-meta"><div class="post-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg><span>May 6, 2025</span></div><div class="post-tags"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag h-4 w-4"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg><div class="flex gap-2"><span class="post-tag">#<!-- -->JavaScript</span><span class="post-tag">#<!-- -->Load-Balancing</span><span class="post-tag">#<!-- -->Node.js</span></div></div></div></article></main></div><footer class="footer"><div class="footer-container"><div class="footer-content md:flex-row"><div class="footer-brand md:text-left"><a class="footer-logo" href="/my-blog/">Cami&#x27;s blog</a><p class="footer-tagline">Personal thoughts and explorations</p></div><div class="social-links"><a href="https://github.com/Arcilac" target="_blank" rel="noopener noreferrer" class="social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github h-5 w-5"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span class="sr-only">GitHub</span></a><a href="https://www.linkedin.com/in/camila-arcila-b28347279/" target="_blank" rel="noopener noreferrer" class="social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin h-5 w-5"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg><span class="sr-only">LinkedIn</span></a><a href="mailto:arcilacamila08@gmail.com" class="social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail h-5 w-5"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg><span class="sr-only">Email</span></a></div></div><div class="footer-bottom"><p> <!-- -->Made with <span class="text-red-500">❤</span> by Camila Arcila</p></div></div></footer></div><script src="/my-blog/_next/static/chunks/webpack-e4b2ba0bd574cac0.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/my-blog/_next/static/css/83cc0ea6f102b864.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/my-blog/_next/static/css/a494df4e6249897d.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[47690,[],\"\"]\n7:I[5613,[],\"\"]\n9:I[31778,[],\"\"]\na:I[70269,[\"250\",\"static/chunks/250-f66e98452b80d3d3.js\",\"185\",\"static/chunks/app/layout-b80959e2834ced79.js\"],\"ThemeProvider\"]\nb:I[63186,[\"250\",\"static/chunks/250-f66e98452b80d3d3.js\",\"185\",\"static/chunks/app/layout-b80959e2834ced79.js\"],\"\"]\nc:I[69148,[\"250\",\"static/chunks/250-f66e98452b80d3d3.js\",\"185\",\"static/chunks/app/layout-b80959e2834ced79.js\"],\"\"]\ne:I[48955,[],\"\"]\n8:[\"slug\",\"node.js-clustering-load-balancing\",\"d\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/my-blog/_next/static/css/83cc0ea6f102b864.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"mF4MjsFj4LUCVXhft3d17\",\"assetPrefix\":\"/my-blog\",\"initialCanonicalUrl\":\"/blog/node.js-clustering-load-balancing/\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"node.js-clustering-load-balancing\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"node.js-clustering-load-balancing\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"node.js-clustering-load-balancing\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",\"$L6\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$8\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/my-blog/_next/static/css/a494df4e6249897d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-black text-white min-h-screen flex flex-col\",\"children\":[\"$\",\"$La\",null,{\"defaultTheme\":\"dark\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col min-h-screen\",\"children\":[[\"$\",\"$Lb\",null,{}],[\"$\",\"div\",null,{\"className\":\"flex-grow\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"$Lc\",null,{}]]}]}]}]]}],null]],\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A personal blog connected with Notion\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/my-blog/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,"f:I[74366,[\"644\",\"static/chunks/644-4de71cea8aeaed79.js\",\"852\",\"static/chunks/852-215445fe88778aae.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-fab3f594c1476cf4.js\"],\"NotionRenderer\"]\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"main\",null,{\"className\":\"post-container\",\"children\":[\"$\",\"article\",null,{\"className\":\"post-article\",\"children\":[null,[\"$\",\"h1\",null,{\"className\":\"post-title\",\"children\":\"Node.js Clustering and Load Balancing\"}],[\"$\",\"div\",null,{\"className\":\"post-content\",\"children\":[\"$\",\"$Lf\",null,{\"blocks\":[{\"id\":\"block-0\",\"type\":\"heading_2\",\"content\":\"What Is Clustering in Node.js?\",\"properties\":{}},{\"id\":\"block-1\",\"type\":\"paragraph\",\"content\":\"Node.js runs on a **single thread**, which means it can only use one CPU core by default. Clustering allows you to **spawn multiple instances** of your application, each running on its own CPU core. These instances, or “workers,” can handle requests in parallel, significantly improving throughput and availability.\",\"properties\":{}},{\"id\":\"block-2\",\"type\":\"heading_2\",\"content\":\"How Does Clustering Work?\",\"properties\":{}},{\"id\":\"block-3\",\"type\":\"paragraph\",\"content\":\"Node.js provides a built-in `cluster` module. A **master process** manages several **worker processes**, each with its own event loop. When a request comes in, it’s distributed among the workers.\",\"properties\":{}},{\"id\":\"block-4\",\"type\":\"heading_3\",\"content\":\"Basic Clustering Example\",\"properties\":{}},{\"id\":\"block-5\",\"type\":\"code\",\"content\":\"```javascript\\n`\\nconst cluster = require('cluster');\\nconst http = require('http');\\nconst os = require('os');\\n\\nif (cluster.isPrimary) {\\n  const numCPUs = os.cpus().length;\\n  console.log(`Master ${process.pid} is running`);\\n\\n  // Fork workers.\\n  for (let i = 0; i \u003c numCPUs; i++) {\\n    cluster.fork();\\n  }\\n\\n  // Optional: Restart worker on exit\\n  cluster.on('exit', (worker) =\u003e {\\n    console.log(`Worker ${worker.process.pid} died. Restarting...`);\\n    cluster.fork();\\n  });\\n} else {\\n  http.createServer((req, res) =\u003e {\\n    res.end(`Handled by worker ${process.pid}`);\\n  }).listen(3000);\\n\\n  console.log(`Worker ${process.pid} started`);\\n}\\n\\n`\\n```\",\"properties\":{\"language\":\"$undefined\"}},{\"id\":\"block-6\",\"type\":\"heading_2\",\"content\":\"Why Use Clustering?\",\"properties\":{}},{\"id\":\"block-7\",\"type\":\"table\",\"content\":\"| Benefit         | Explanation                                            |\\n| --------------- | ------------------------------------------------------ |\\n| Performance     | Leverages multi-core systems to handle more requests   |\\n| Fault tolerance | If a worker crashes, others continue to serve requests |\\n| Scalability     | Can scale apps horizontally by running more processes  |\\n| Simple setup    | Requires minimal changes to existing Node.js apps      |\",\"properties\":{}},{\"id\":\"block-7-0\",\"type\":\"table_row\",\"content\":\"\",\"properties\":{}},{\"id\":\"block-7-1\",\"type\":\"table_row\",\"content\":\"\",\"properties\":{}},{\"id\":\"block-7-2\",\"type\":\"table_row\",\"content\":\"\",\"properties\":{}},{\"id\":\"block-7-3\",\"type\":\"table_row\",\"content\":\"\",\"properties\":{}},{\"id\":\"block-7-4\",\"type\":\"table_row\",\"content\":\"\",\"properties\":{}},{\"id\":\"block-8\",\"type\":\"divider\",\"content\":\"---\",\"properties\":{}},{\"id\":\"block-9\",\"type\":\"heading_2\",\"content\":\"Load Balancing Concepts\",\"properties\":{}},{\"id\":\"block-10\",\"type\":\"paragraph\",\"content\":\"Clustering distributes load **within a single machine**, but to handle **higher traffic or redundancy**, you may need **external load balancing**:\",\"properties\":{}},{\"id\":\"block-11\",\"type\":\"heading_3\",\"content\":\"Common Load Balancing Methods:\",\"properties\":{}},{\"id\":\"block-12\",\"type\":\"bulleted_list_item\",\"content\":\"- **Round-robin:** Requests are distributed evenly across instances\",\"properties\":{}},{\"id\":\"block-13\",\"type\":\"bulleted_list_item\",\"content\":\"- **Least connections:** Directs traffic to the server with the fewest active connections\",\"properties\":{}},{\"id\":\"block-14\",\"type\":\"bulleted_list_item\",\"content\":\"- **Sticky sessions:** Ensures a user stays connected to the same worker or server\",\"properties\":{}},{\"id\":\"block-15\",\"type\":\"heading_3\",\"content\":\"Load Balancing Tools:\",\"properties\":{}},{\"id\":\"block-16\",\"type\":\"bulleted_list_item\",\"content\":\"- **Nginx** or **HAProxy**: Can sit in front of clustered Node.js servers\",\"properties\":{}},{\"id\":\"block-17\",\"type\":\"bulleted_list_item\",\"content\":\"- **PM2**: A Node.js process manager that supports clustering and load balancing\",\"properties\":{}},{\"id\":\"block-18\",\"type\":\"bulleted_list_item\",\"content\":\"- **Cloud load balancers**: Offered by AWS, GCP, Azure, etc.\",\"properties\":{}},{\"id\":\"block-19\",\"type\":\"divider\",\"content\":\"---\",\"properties\":{}},{\"id\":\"block-20\",\"type\":\"heading_2\",\"content\":\"Combining Clustering with Load Balancing\",\"properties\":{}},{\"id\":\"block-21\",\"type\":\"paragraph\",\"content\":\"You can combine both strategies for maximum performance:\",\"properties\":{}},{\"id\":\"block-22\",\"type\":\"bulleted_list_item\",\"content\":\"- Use **Node.js clustering** to utilize all cores of each server\",\"properties\":{}},{\"id\":\"block-23\",\"type\":\"bulleted_list_item\",\"content\":\"- Use a **reverse proxy** like **Nginx** to distribute load across multiple servers\",\"properties\":{}},{\"id\":\"block-24\",\"type\":\"divider\",\"content\":\"---\",\"properties\":{}},{\"id\":\"block-25\",\"type\":\"heading_2\",\"content\":\"Best Practices\",\"properties\":{}},{\"id\":\"block-26\",\"type\":\"bulleted_list_item\",\"content\":\"- Always monitor worker health and restart on failure\",\"properties\":{}},{\"id\":\"block-27\",\"type\":\"bulleted_list_item\",\"content\":\"- Share minimal state between workers (use external storage like Redis if needed)\",\"properties\":{}},{\"id\":\"block-28\",\"type\":\"bulleted_list_item\",\"content\":\"- Use sticky sessions if your app relies on session-based auth\",\"properties\":{}},{\"id\":\"block-29\",\"type\":\"bulleted_list_item\",\"content\":\"- Avoid memory leaks — they’ll affect all workers over time\",\"properties\":{}},{\"id\":\"block-30\",\"type\":\"bulleted_list_item\",\"content\":\"- Test under load to determine ideal number of workers\",\"properties\":{}},{\"id\":\"block-31\",\"type\":\"divider\",\"content\":\"---\",\"properties\":{}},{\"id\":\"block-32\",\"type\":\"heading_2\",\"content\":\"Conclusion\",\"properties\":{}},{\"id\":\"block-33\",\"type\":\"paragraph\",\"content\":\"Clustering and load balancing are essential for scaling Node.js applications effectively. By leveraging multiple CPU cores and distributing traffic smartly, you can handle more users, increase resilience, and build faster, more reliable backends.\",\"properties\":{}}]}]}],[\"$\",\"div\",null,{\"className\":\"post-meta\",\"children\":[[\"$\",\"div\",null,{\"className\":\"post-date\",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"rect\",\"eu3xkr\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\",\"ry\":\"2\"}],[\"$\",\"line\",\"m3sa8f\",{\"x1\":\"16\",\"x2\":\"16\",\"y1\":\"2\",\"y2\":\"6\"}],[\"$\",\"line\",\"18kwsl\",{\"x1\":\"8\",\"x2\":\"8\",\"y1\":\"2\",\"y2\":\"6\"}],[\"$\",\"line\",\"xt86sb\",{\"x1\":\"3\",\"x2\":\"21\",\"y1\":\"10\",\"y2\":\"10\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"May 6, 2025\"}]]}],[\"$\",\"div\",null,{\"className\":\"post-tags\",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-tag h-4 w-4\",\"children\":[[\"$\",\"path\",\"14b2ls\",{\"d\":\"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z\"}],[\"$\",\"path\",\"7u93v4\",{\"d\":\"M7 7h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"className\":\"flex gap-2\",\"children\":[[\"$\",\"span\",\"JavaScript\",{\"className\":\"post-tag\",\"children\":[\"#\",\"JavaScript\"]}],[\"$\",\"span\",\"Load-Balancing\",{\"className\":\"post-tag\",\"children\":[\"#\",\"Load-Balancing\"]}],[\"$\",\"span\",\"Node.js\",{\"className\":\"post-tag\",\"children\":[\"#\",\"Node.js\"]}]]}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>
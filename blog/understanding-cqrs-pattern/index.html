<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/my-blog/_next/static/css/83cc0ea6f102b864.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/my-blog/_next/static/css/b35b50df51129daa.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/my-blog/_next/static/chunks/webpack-b4f5c1b4f471b8ec.js" crossorigin=""/><script src="/my-blog/_next/static/chunks/fd9d1056-8eeb8092ef3d3dd5.js" async="" crossorigin=""></script><script src="/my-blog/_next/static/chunks/938-84fed2705efa299b.js" async="" crossorigin=""></script><script src="/my-blog/_next/static/chunks/main-app-f4d94776ad940ad5.js" async="" crossorigin=""></script><script src="/my-blog/_next/static/chunks/250-f66e98452b80d3d3.js" async=""></script><script src="/my-blog/_next/static/chunks/app/layout-eeb53c07ffb10a3f.js" async=""></script><script src="/my-blog/_next/static/chunks/644-4de71cea8aeaed79.js" async=""></script><script src="/my-blog/_next/static/chunks/852-215445fe88778aae.js" async=""></script><script src="/my-blog/_next/static/chunks/app/blog/%5Bslug%5D/page-704c76d6a8653be0.js" async=""></script><link rel="icon" href="/favicon.ico"/><title>Blog</title><meta name="description" content="A personal blog connected with Notion"/><link rel="icon" href="/my-blog/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/my-blog/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="bg-black text-white min-h-screen flex flex-col"><div class="flex flex-col min-h-screen"><header class="navbar"><div class="navbar-container"><a class="navbar-logo" href="/my-blog/">Cami&#x27;s Blog</a><nav class="navbar-nav hidden md:flex"><a class="navbar-link" href="/my-blog/">Home</a><a class="navbar-link" href="/my-blog/blog/">Blog</a><a class="navbar-link" href="https://arcilac.github.io/portfolio/">Contact</a></nav><div class="flex items-center gap-4"></div></div></header><div class="flex-grow"><main class="post-container"><article class="post-article"><h1 class="post-title">Understanding CQRS</h1><div class="post-content"><div class="notion-content" style="color:var(--foreground)"><h1 style="font-size:2rem;font-weight:bold;margin-top:2.5rem;margin-bottom:1rem;border-bottom:1px solid var(--border);padding-bottom:0.5rem">Command Query Responsibility Segregation</h1><p style="margin-bottom:1rem;line-height:1.7">Command Query Responsibility Segregation (CQRS) is an architectural pattern that separates read and write operations for a data store. This pattern, introduced by Greg Young, builds upon the concept of Command-Query Separation (CQS) proposed by Bertrand Meyer, but takes it a step further by potentially using separate data models for reading and writing.</p><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">What is CQRS?</h2><p style="margin-bottom:1rem;line-height:1.7">At its core, CQRS divides an application's operations into two categories:</p><ul style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:disc"><li style="margin-bottom:0.5rem"><strong>Commands</strong>: Operations that change state (create, update, delete)</li><li style="margin-bottom:0.5rem"><strong>Queries</strong>: Operations that return data without changing state (read)</li></ul><p style="margin-bottom:1rem;line-height:1.7">In traditional architectures, the same data model is used for both reading and writing operations. CQRS challenges this approach by suggesting that these operations can be separated, optimized independently, and potentially use different data models or even different data stores.</p><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Key Principles of CQRS</h2><ol style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:decimal"><li style="margin-bottom:0.5rem"><strong>Separation of Concerns</strong>: Read and write responsibilities are handled by different components</li><li style="margin-bottom:0.5rem"><strong>Different Models</strong>: Commands and queries can use different data models optimized for their specific needs</li><li style="margin-bottom:0.5rem"><strong>Eventual Consistency</strong>: The read model may be eventually consistent with the write model</li><li style="margin-bottom:0.5rem"><strong>Scalability</strong>: Read and write sides can be scaled independently based on their different requirements</li></ol><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Basic CQRS Structure</h2><p style="margin-bottom:1rem;line-height:1.7">A basic CQRS implementation might look like this:</p><div style="margin-bottom:1.5rem;margin-top:1.5rem"><pre style="color:#d4d4d4;font-size:0.9rem;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:.5em 0;overflow:auto;background:#1e1e1e;border-radius:0.5rem;background-color:#1E1E1E"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#6a9955">// Command Side</span><span>
</span><span></span><span class="token" style="color:#569CD6">interface</span><span> </span><span class="token" style="color:#4ec9b0">ICommandHandler</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">TCommand</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">handle</span><span class="token" style="color:#d4d4d4">(</span><span>command</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">TCommand</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">CreateUserCommand</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#569CD6">readonly</span><span> username</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#569CD6">readonly</span><span> email</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">CreateUserCommandHandler</span><span> </span><span class="token" style="color:#569CD6">implements</span><span> </span><span class="token" style="color:#4ec9b0">ICommandHandler</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">CreateUserCommand</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> userWriteRepository</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">UserWriteRepository</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">handle</span><span class="token" style="color:#d4d4d4">(</span><span>command</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">CreateUserCommand</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> user </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">User</span><span class="token" style="color:#d4d4d4">(</span><span>command</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">username</span><span class="token" style="color:#d4d4d4">,</span><span> command</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">email</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">userWriteRepository</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">save</span><span class="token" style="color:#d4d4d4">(</span><span>user</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// Could also publish an event here</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#6a9955">// Query Side</span><span>
</span><span></span><span class="token" style="color:#569CD6">interface</span><span> </span><span class="token" style="color:#4ec9b0">IQueryHandler</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">TQuery</span><span class="token" style="color:#d4d4d4">,</span><span class="token" style="color:#4ec9b0"> </span><span class="token" style="color:#4ec9b0">TResult</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">handle</span><span class="token" style="color:#d4d4d4">(</span><span>query</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">TQuery</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">TResult</span><span class="token" style="color:#d4d4d4">&gt;</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">GetUserByIdQuery</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">public</span><span> </span><span class="token" style="color:#569CD6">readonly</span><span> userId</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">GetUserByIdQueryHandler</span><span> </span><span class="token" style="color:#569CD6">implements</span><span> </span><span class="token" style="color:#4ec9b0">IQueryHandler</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">GetUserByIdQuery</span><span class="token" style="color:#d4d4d4">,</span><span class="token" style="color:#4ec9b0"> </span><span class="token" style="color:#4ec9b0">UserReadModel</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> userReadRepository</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">UserReadRepository</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">handle</span><span class="token" style="color:#d4d4d4">(</span><span>query</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">GetUserByIdQuery</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">UserReadModel</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">userReadRepository</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">findById</span><span class="token" style="color:#d4d4d4">(</span><span>query</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">userId</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span></code></pre></div><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">CQRS with Different Data Stores</h2><p style="margin-bottom:1rem;line-height:1.7">One of the more advanced implementations of CQRS involves using different data stores for reading and writing:</p><div style="margin-bottom:1.5rem;margin-top:1.5rem"><pre style="color:#d4d4d4;font-size:0.9rem;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:.5em 0;overflow:auto;background:#1e1e1e;border-radius:0.5rem;background-color:#1E1E1E"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#6a9955">// Command side (using a relational database)</span><span>
</span><span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">UserWriteRepository</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> dbConnection</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">SqlConnection</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">save</span><span class="token" style="color:#d4d4d4">(</span><span>user</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">User</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">dbConnection</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">execute</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      </span><span class="token" style="color:#ce9178">&#x27;INSERT INTO users (id, username, email, created_at) VALUES (?, ?, ?, ?)&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">[</span><span>user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">id</span><span class="token" style="color:#d4d4d4">,</span><span> user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">username</span><span class="token" style="color:#d4d4d4">,</span><span> user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">email</span><span class="token" style="color:#d4d4d4">,</span><span> user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">createdAt</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>    </span><span class="token" style="color:#6a9955">// Publish an event for the read side</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">eventBus</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">publish</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">UserCreatedEvent</span><span class="token" style="color:#d4d4d4">(</span><span>user</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#6a9955">// Query side (using a document database optimized for reads)</span><span>
</span><span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">UserReadRepository</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> documentDb</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DocumentDbClient</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">findById</span><span class="token" style="color:#d4d4d4">(</span><span>userId</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">UserReadModel</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">documentDb</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">collection</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;users&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">findOne</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span> id</span><span class="token" style="color:#d4d4d4">:</span><span> userId </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">findByUsername</span><span class="token" style="color:#d4d4d4">(</span><span>username</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">UserReadModel</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">documentDb</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">collection</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;users&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">findOne</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span> username </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#6a9955">// Event handler to keep read model updated</span><span>
</span><span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">UserCreatedEventHandler</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> documentDb</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DocumentDbClient</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">handle</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">UserCreatedEvent</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">const</span><span> userReadModel </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">UserReadModel</span><span class="token" style="color:#d4d4d4">(</span><span>
</span><span>      event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">id</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">username</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">email</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">user</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">createdAt</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">documentDb</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">collection</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;users&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">insertOne</span><span class="token" style="color:#d4d4d4">(</span><span>userReadModel</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span></code></pre></div><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">When to Use CQRS</h2><p style="margin-bottom:1rem;line-height:1.7">CQRS is particularly beneficial in the following scenarios:</p><ol style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:decimal"><li style="margin-bottom:0.5rem"><strong>Complex domains</strong> with sophisticated business rules</li><li style="margin-bottom:0.5rem"><strong>High-performance applications</strong> with different scaling needs for reads and writes</li><li style="margin-bottom:0.5rem"><strong>Collaborative domains</strong> where multiple users might update the same data</li><li style="margin-bottom:0.5rem"><strong>Event-driven architectures</strong> and systems that need to maintain an audit log</li><li style="margin-bottom:0.5rem"><strong>Microservice architectures</strong> where different services have different data requirements</li></ol><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">When Not to Use CQRS</h2><p style="margin-bottom:1rem;line-height:1.7">CQRS isn't always the right choice:</p><ol style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:decimal"><li style="margin-bottom:0.5rem"><strong>Simple CRUD applications</strong> where the complexity overhead isn't justified</li><li style="margin-bottom:0.5rem"><strong>Small applications</strong> with limited domain complexity</li><li style="margin-bottom:0.5rem"><strong>Applications where read and write loads are balanced</strong> and don't require separate scaling</li><li style="margin-bottom:0.5rem"><strong>Teams new to the pattern</strong> without experience handling eventual consistency</li></ol><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Benefits of CQRS</h2><ol style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:decimal"><li style="margin-bottom:0.5rem"><strong>Optimized Data Models</strong>: Each side can use a data model optimized for its specific needs</li><li style="margin-bottom:0.5rem"><strong>Independent Scaling</strong>: Read and write operations can be scaled independently</li><li style="margin-bottom:0.5rem"><strong>Security</strong>: Finer control over access permissions for read vs. write operations</li><li style="margin-bottom:0.5rem"><strong>Performance</strong>: Read models can be denormalized for optimal query performance</li><li style="margin-bottom:0.5rem"><strong>Flexibility</strong>: Freedom to use different technologies for each side</li></ol><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Challenges of CQRS</h2><ol style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:decimal"><li style="margin-bottom:0.5rem"><strong>Complexity</strong>: Introduces more moving parts and complexity</li><li style="margin-bottom:0.5rem"><strong>Eventual Consistency</strong>: The read model may lag behind the write model</li><li style="margin-bottom:0.5rem"><strong>Development Overhead</strong>: Requires maintaining multiple models and potential synchronization logic</li><li style="margin-bottom:0.5rem"><strong>Learning Curve</strong>: Teams need to understand the pattern and its implications</li></ol><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">CQRS and Event Sourcing</h2><p style="margin-bottom:1rem;line-height:1.7">CQRS is often paired with Event Sourcing, though they are separate patterns. Event Sourcing stores the complete history of all changes as a sequence of events, rather than just the current state. This combination is powerful but adds further complexity:</p><div style="margin-bottom:1.5rem;margin-top:1.5rem"><pre style="color:#d4d4d4;font-size:0.9rem;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1rem;margin:.5em 0;overflow:auto;background:#1e1e1e;border-radius:0.5rem;background-color:#1E1E1E"><code class="language-typescript" style="white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#6a9955">// Event Sourcing with CQRS</span><span>
</span><span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">UserAggregate</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> events</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DomainEvent</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">private</span><span> state</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">UserState</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">UserState</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#dcdcaa">createUser</span><span class="token" style="color:#d4d4d4">(</span><span>username</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">,</span><span> email</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569CD6">void</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// Business logic validation</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">!</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">isValidEmail</span><span class="token" style="color:#d4d4d4">(</span><span>email</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">throw</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Error</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;Invalid email&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>    </span><span class="token" style="color:#6a9955">// Apply the event</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">applyEvent</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token" style="color:#4ec9b0">UserCreatedEvent</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#dcdcaa">uuidv4</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> username</span><span class="token" style="color:#d4d4d4">,</span><span> email</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#569CD6">new</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Date</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">private</span><span> </span><span class="token" style="color:#dcdcaa">applyEvent</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DomainEvent</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569CD6">void</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">events</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">push</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">state</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">state</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">apply</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#dcdcaa">getUncommittedEvents</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DomainEvent</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token spread" style="color:#d4d4d4">...</span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">events</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">private</span><span> </span><span class="token" style="color:#dcdcaa">isValidEmail</span><span class="token" style="color:#d4d4d4">(</span><span>email</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">boolean</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// Email validation logic</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token regex-delimiter" style="color:#d16969">/</span><span class="token regex-source language-regex" style="color:#d16969">^[^\s@]+@[^\s@]+\.[^\s@]+$</span><span class="token regex-delimiter" style="color:#d16969">/</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">test</span><span class="token" style="color:#d4d4d4">(</span><span>email</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#6a9955">// Event Store</span><span>
</span><span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">EventStore</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">saveEvents</span><span class="token" style="color:#d4d4d4">(</span><span>aggregateId</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">,</span><span> events</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DomainEvent</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">,</span><span> expectedVersion</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">number</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// Save events with optimistic concurrency check</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">getEvents</span><span class="token" style="color:#d4d4d4">(</span><span>aggregateId</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">string</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">DomainEvent</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// Retrieve all events for an aggregate</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span></span><span class="token" style="color:#6a9955">// Read Model Projector</span><span>
</span><span></span><span class="token" style="color:#569CD6">class</span><span> </span><span class="token" style="color:#4ec9b0">UserProjector</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">constructor</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#569CD6">private</span><span> readDb</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DocumentDbClient</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">project</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">DomainEvent</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">if</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span>event </span><span class="token" style="color:#569CD6">instanceof</span><span> </span><span class="token" style="color:#4ec9b0">UserCreatedEvent</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">handleUserCreated</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#6a9955">// Handle other event types</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span>
<span>  </span><span class="token" style="color:#569CD6">private</span><span> </span><span class="token" style="color:#569CD6">async</span><span> </span><span class="token" style="color:#dcdcaa">handleUserCreated</span><span class="token" style="color:#d4d4d4">(</span><span>event</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#4ec9b0">UserCreatedEvent</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token known-class-name" style="color:#4ec9b0">Promise</span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#569CD6">void</span><span class="token" style="color:#d4d4d4">&gt;</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#c586c0">await</span><span> </span><span class="token" style="color:#569CD6">this</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">readDb</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">collection</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;users&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">insertOne</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      id</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">userId</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      username</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">username</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      email</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">email</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      createdAt</span><span class="token" style="color:#d4d4d4">:</span><span> event</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">timestamp</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span>
</span></code></pre></div><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Implementing CQRS Gradually</h2><p style="margin-bottom:1rem;line-height:1.7">You can adopt CQRS incrementally:</p><ol style="padding-left:1.5rem;margin-bottom:1.5rem;list-style-type:decimal"><li style="margin-bottom:0.5rem">Start by separating command and query responsibilities in your service layer</li><li style="margin-bottom:0.5rem">Gradually introduce separate models for complex areas of your domain</li><li style="margin-bottom:0.5rem">Consider different data stores for the most performance-critical parts</li><li style="margin-bottom:0.5rem">Add event sourcing where historical data is valuable</li></ol><h2 style="font-size:1.5rem;font-weight:bold;margin-top:2rem;margin-bottom:0.75rem;padding-bottom:0.25rem">Conclusion</h2><p style="margin-bottom:1rem;line-height:1.7">CQRS is a powerful architectural pattern that provides significant benefits for complex, high-scale applications with different read and write requirements. While it introduces additional complexity, the separation of concerns allows for more targeted optimizations and greater flexibility in how you design and scale your system.</p><p style="margin-bottom:1rem;line-height:1.7">As with any architectural pattern, CQRS should be applied thoughtfully and selectively based on your specific requirements, rather than as a default approach for all applications. When implemented correctly in the right context, it can significantly improve the scalability, maintainability, and performance of your software.</p></div></div><div class="post-meta"><div class="post-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar h-4 w-4"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg><span>April 24, 2025</span></div><div class="post-tags"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag h-4 w-4"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg><div class="flex gap-2"><span class="post-tag">#<!-- -->event-sourcing</span><span class="post-tag">#<!-- -->Microservices</span><span class="post-tag">#<!-- -->cqrs</span></div></div></div></article></main></div><footer class="footer"><div class="footer-container"><div class="footer-content md:flex-row"><div class="footer-brand md:text-left"><a class="footer-logo" href="/my-blog/">Cami&#x27;s Blog</a><p class="footer-tagline">Personal thoughts and explorations</p></div><div class="social-links"><a href="https://github.com/Arcilac" target="_blank" rel="noopener noreferrer" class="social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github h-5 w-5"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span class="sr-only">GitHub</span></a><a href="https://www.linkedin.com/in/camila-arcila-b28347279/" target="_blank" rel="noopener noreferrer" class="social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin h-5 w-5"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg><span class="sr-only">LinkedIn</span></a><a href="mailto:arcilacamila08@gmail.com" class="social-link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail h-5 w-5"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg><span class="sr-only">Email</span></a></div></div><div class="footer-bottom"><p> <!-- -->Made with <span class="text-red-500"></span> by Camila Arcila</p></div></div></footer></div><script src="/my-blog/_next/static/chunks/webpack-b4f5c1b4f471b8ec.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/my-blog/_next/static/css/83cc0ea6f102b864.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/my-blog/_next/static/css/b35b50df51129daa.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[47690,[],\"\"]\n7:I[5613,[],\"\"]\n9:I[31778,[],\"\"]\na:I[70269,[\"250\",\"static/chunks/250-f66e98452b80d3d3.js\",\"185\",\"static/chunks/app/layout-eeb53c07ffb10a3f.js\"],\"ThemeProvider\"]\nb:I[63186,[\"250\",\"static/chunks/250-f66e98452b80d3d3.js\",\"185\",\"static/chunks/app/layout-eeb53c07ffb10a3f.js\"],\"\"]\nc:I[69148,[\"250\",\"static/chunks/250-f66e98452b80d3d3.js\",\"185\",\"static/chunks/app/layout-eeb53c07ffb10a3f.js\"],\"\"]\ne:I[48955,[],\"\"]\n8:[\"slug\",\"understanding-cqrs-pattern\",\"d\"]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/my-blog/_next/static/css/83cc0ea6f102b864.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"FW1tFJCJUawXhqoRW7VNF\",\"assetPrefix\":\"/my-blog\",\"initialCanonicalUrl\":\"/blog/understanding-cqrs-pattern/\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"understanding-cqrs-pattern\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"understanding-cqrs-pattern\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"understanding-cqrs-pattern\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",\"$L6\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$8\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/my-blog/_next/static/css/b35b50df51129daa.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-black text-white min-h-screen flex flex-col\",\"children\":[\"$\",\"$La\",null,{\"defaultTheme\":\"dark\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col min-h-screen\",\"children\":[[\"$\",\"$Lb\",null,{}],[\"$\",\"div\",null,{\"className\":\"flex-grow\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}],[\"$\",\"$Lc\",null,{}]]}]}]}]]}],null]],\"initialHead\":[false,\"$Ld\"],\"globalErrorComponent\":\"$e\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A personal blog connected with Notion\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/my-blog/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n5:null\n"])</script><script>self.__next_f.push([1,"f:I[74366,[\"644\",\"static/chunks/644-4de71cea8aeaed79.js\",\"852\",\"static/chunks/852-215445fe88778aae.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-704c76d6a8653be0.js\"],\"NotionRenderer\"]\n10:T42b,"])</script><script>self.__next_f.push([1,"```typescript\n`\n// Command Side\ninterface ICommandHandler\u003cTCommand\u003e {\n  handle(command: TCommand): Promise\u003cvoid\u003e;\n}\n\nclass CreateUserCommand {\n  constructor(public readonly username: string, public readonly email: string) {}\n}\n\nclass CreateUserCommandHandler implements ICommandHandler\u003cCreateUserCommand\u003e {\n  constructor(private userWriteRepository: UserWriteRepository) {}\n\n  async handle(command: CreateUserCommand): Promise\u003cvoid\u003e {\n    const user = new User(command.username, command.email);\n    await this.userWriteRepository.save(user);\n    // Could also publish an event here\n  }\n}\n\n// Query Side\ninterface IQueryHandler\u003cTQuery, TResult\u003e {\n  handle(query: TQuery): Promise\u003cTResult\u003e;\n}\n\nclass GetUserByIdQuery {\n  constructor(public readonly userId: string) {}\n}\n\nclass GetUserByIdQueryHandler implements IQueryHandler\u003cGetUserByIdQuery, UserReadModel\u003e {\n  constructor(private userReadRepository: UserReadRepository) {}\n\n  async handle(query: GetUserByIdQuery): Promise\u003cUserReadModel\u003e {\n    return await this.userReadRepository.findById(query.userId);\n  }\n}\n`\n```"])</script><script>self.__next_f.push([1,"11:T53f,"])</script><script>self.__next_f.push([1,"```typescript\n`\n// Command side (using a relational database)\nclass UserWriteRepository {\n  constructor(private dbConnection: SqlConnection) {}\n\n  async save(user: User): Promise\u003cvoid\u003e {\n    await this.dbConnection.execute(\n      'INSERT INTO users (id, username, email, created_at) VALUES (?, ?, ?, ?)',\n      [user.id, user.username, user.email, user.createdAt]\n    );\n\n    // Publish an event for the read side\n    await this.eventBus.publish(new UserCreatedEvent(user));\n  }\n}\n\n// Query side (using a document database optimized for reads)\nclass UserReadRepository {\n  constructor(private documentDb: DocumentDbClient) {}\n\n  async findById(userId: string): Promise\u003cUserReadModel\u003e {\n    return await this.documentDb.collection('users').findOne({ id: userId });\n  }\n\n  async findByUsername(username: string): Promise\u003cUserReadModel\u003e {\n    return await this.documentDb.collection('users').findOne({ username });\n  }\n}\n\n// Event handler to keep read model updated\nclass UserCreatedEventHandler {\n  constructor(private documentDb: DocumentDbClient) {}\n\n  async handle(event: UserCreatedEvent): Promise\u003cvoid\u003e {\n    const userReadModel = new UserReadModel(\n      event.user.id,\n      event.user.username,\n      event.user.email,\n      event.user.createdAt\n    );\n\n    await this.documentDb.collection('users').insertOne(userReadModel);\n  }\n}\n`\n```"])</script><script>self.__next_f.push([1,"12:T65f,"])</script><script>self.__next_f.push([1,"```typescript\n`\n// Event Sourcing with CQRS\nclass UserAggregate {\n  private events: DomainEvent[] = [];\n  private state: UserState = new UserState();\n\n  createUser(username: string, email: string): void {\n    // Business logic validation\n    if (!this.isValidEmail(email)) {\n      throw new Error('Invalid email');\n    }\n\n    // Apply the event\n    this.applyEvent(new UserCreatedEvent(uuidv4(), username, email, new Date()));\n  }\n\n  private applyEvent(event: DomainEvent): void {\n    this.events.push(event);\n    this.state = this.state.apply(event);\n  }\n\n  getUncommittedEvents(): DomainEvent[] {\n    return [...this.events];\n  }\n\n  private isValidEmail(email: string): boolean {\n    // Email validation logic\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n  }\n}\n\n// Event Store\nclass EventStore {\n  async saveEvents(aggregateId: string, events: DomainEvent[], expectedVersion: number): Promise\u003cvoid\u003e {\n    // Save events with optimistic concurrency check\n  }\n\n  async getEvents(aggregateId: string): Promise\u003cDomainEvent[]\u003e {\n    // Retrieve all events for an aggregate\n  }\n}\n\n// Read Model Projector\nclass UserProjector {\n  constructor(private readDb: DocumentDbClient) {}\n\n  async project(event: DomainEvent): Promise\u003cvoid\u003e {\n    if (event instanceof UserCreatedEvent) {\n      await this.handleUserCreated(event);\n    }\n    // Handle other event types\n  }\n\n  private async handleUserCreated(event: UserCreatedEvent): Promise\u003cvoid\u003e {\n    await this.readDb.collection('users').insertOne({\n      id: event.userId,\n      username: event.username,\n      email: event.email,\n      createdAt: event.timestamp\n    });\n  }\n}\n`\n```"])</script><script>self.__next_f.push([1,"6:[\"$\",\"main\",null,{\"className\":\"post-container\",\"children\":[\"$\",\"article\",null,{\"className\":\"post-article\",\"children\":[null,[\"$\",\"h1\",null,{\"className\":\"post-title\",\"children\":\"Understanding CQRS\"}],[\"$\",\"div\",null,{\"className\":\"post-content\",\"children\":[\"$\",\"$Lf\",null,{\"blocks\":[{\"id\":\"block-0\",\"type\":\"heading_1\",\"content\":\"Command Query Responsibility Segregation\",\"properties\":{}},{\"id\":\"block-1\",\"type\":\"paragraph\",\"content\":\"Command Query Responsibility Segregation (CQRS) is an architectural pattern that separates read and write operations for a data store. This pattern, introduced by Greg Young, builds upon the concept of Command-Query Separation (CQS) proposed by Bertrand Meyer, but takes it a step further by potentially using separate data models for reading and writing.\",\"properties\":{}},{\"id\":\"block-2\",\"type\":\"heading_2\",\"content\":\"What is CQRS?\",\"properties\":{}},{\"id\":\"block-3\",\"type\":\"paragraph\",\"content\":\"At its core, CQRS divides an application's operations into two categories:\",\"properties\":{}},{\"id\":\"block-4\",\"type\":\"bulleted_list_item\",\"content\":\"- **Commands**: Operations that change state (create, update, delete)\",\"properties\":{}},{\"id\":\"block-5\",\"type\":\"bulleted_list_item\",\"content\":\"- **Queries**: Operations that return data without changing state (read)\",\"properties\":{}},{\"id\":\"block-6\",\"type\":\"paragraph\",\"content\":\"In traditional architectures, the same data model is used for both reading and writing operations. CQRS challenges this approach by suggesting that these operations can be separated, optimized independently, and potentially use different data models or even different data stores.\",\"properties\":{}},{\"id\":\"block-7\",\"type\":\"heading_2\",\"content\":\"Key Principles of CQRS\",\"properties\":{}},{\"id\":\"block-8\",\"type\":\"numbered_list_item\",\"content\":\"1. **Separation of Concerns**: Read and write responsibilities are handled by different components\",\"properties\":{}},{\"id\":\"block-9\",\"type\":\"numbered_list_item\",\"content\":\"2. **Different Models**: Commands and queries can use different data models optimized for their specific needs\",\"properties\":{}},{\"id\":\"block-10\",\"type\":\"numbered_list_item\",\"content\":\"3. **Eventual Consistency**: The read model may be eventually consistent with the write model\",\"properties\":{}},{\"id\":\"block-11\",\"type\":\"numbered_list_item\",\"content\":\"4. **Scalability**: Read and write sides can be scaled independently based on their different requirements\",\"properties\":{}},{\"id\":\"block-12\",\"type\":\"heading_2\",\"content\":\"Basic CQRS Structure\",\"properties\":{}},{\"id\":\"block-13\",\"type\":\"paragraph\",\"content\":\"A basic CQRS implementation might look like this:\",\"properties\":{}},{\"id\":\"block-14\",\"type\":\"code\",\"content\":\"$10\",\"properties\":{\"language\":\"$undefined\"}},{\"id\":\"block-15\",\"type\":\"heading_2\",\"content\":\"CQRS with Different Data Stores\",\"properties\":{}},{\"id\":\"block-16\",\"type\":\"paragraph\",\"content\":\"One of the more advanced implementations of CQRS involves using different data stores for reading and writing:\",\"properties\":{}},{\"id\":\"block-17\",\"type\":\"code\",\"content\":\"$11\",\"properties\":{\"language\":\"$undefined\"}},{\"id\":\"block-18\",\"type\":\"heading_2\",\"content\":\"When to Use CQRS\",\"properties\":{}},{\"id\":\"block-19\",\"type\":\"paragraph\",\"content\":\"CQRS is particularly beneficial in the following scenarios:\",\"properties\":{}},{\"id\":\"block-20\",\"type\":\"numbered_list_item\",\"content\":\"1. **Complex domains** with sophisticated business rules\",\"properties\":{}},{\"id\":\"block-21\",\"type\":\"numbered_list_item\",\"content\":\"2. **High-performance applications** with different scaling needs for reads and writes\",\"properties\":{}},{\"id\":\"block-22\",\"type\":\"numbered_list_item\",\"content\":\"3. **Collaborative domains** where multiple users might update the same data\",\"properties\":{}},{\"id\":\"block-23\",\"type\":\"numbered_list_item\",\"content\":\"4. **Event-driven architectures** and systems that need to maintain an audit log\",\"properties\":{}},{\"id\":\"block-24\",\"type\":\"numbered_list_item\",\"content\":\"5. **Microservice architectures** where different services have different data requirements\",\"properties\":{}},{\"id\":\"block-25\",\"type\":\"heading_2\",\"content\":\"When Not to Use CQRS\",\"properties\":{}},{\"id\":\"block-26\",\"type\":\"paragraph\",\"content\":\"CQRS isn't always the right choice:\",\"properties\":{}},{\"id\":\"block-27\",\"type\":\"numbered_list_item\",\"content\":\"1. **Simple CRUD applications** where the complexity overhead isn't justified\",\"properties\":{}},{\"id\":\"block-28\",\"type\":\"numbered_list_item\",\"content\":\"2. **Small applications** with limited domain complexity\",\"properties\":{}},{\"id\":\"block-29\",\"type\":\"numbered_list_item\",\"content\":\"3. **Applications where read and write loads are balanced** and don't require separate scaling\",\"properties\":{}},{\"id\":\"block-30\",\"type\":\"numbered_list_item\",\"content\":\"4. **Teams new to the pattern** without experience handling eventual consistency\",\"properties\":{}},{\"id\":\"block-31\",\"type\":\"heading_2\",\"content\":\"Benefits of CQRS\",\"properties\":{}},{\"id\":\"block-32\",\"type\":\"numbered_list_item\",\"content\":\"1. **Optimized Data Models**: Each side can use a data model optimized for its specific needs\",\"properties\":{}},{\"id\":\"block-33\",\"type\":\"numbered_list_item\",\"content\":\"2. **Independent Scaling**: Read and write operations can be scaled independently\",\"properties\":{}},{\"id\":\"block-34\",\"type\":\"numbered_list_item\",\"content\":\"3. **Security**: Finer control over access permissions for read vs. write operations\",\"properties\":{}},{\"id\":\"block-35\",\"type\":\"numbered_list_item\",\"content\":\"4. **Performance**: Read models can be denormalized for optimal query performance\",\"properties\":{}},{\"id\":\"block-36\",\"type\":\"numbered_list_item\",\"content\":\"5. **Flexibility**: Freedom to use different technologies for each side\",\"properties\":{}},{\"id\":\"block-37\",\"type\":\"heading_2\",\"content\":\"Challenges of CQRS\",\"properties\":{}},{\"id\":\"block-38\",\"type\":\"numbered_list_item\",\"content\":\"1. **Complexity**: Introduces more moving parts and complexity\",\"properties\":{}},{\"id\":\"block-39\",\"type\":\"numbered_list_item\",\"content\":\"2. **Eventual Consistency**: The read model may lag behind the write model\",\"properties\":{}},{\"id\":\"block-40\",\"type\":\"numbered_list_item\",\"content\":\"3. **Development Overhead**: Requires maintaining multiple models and potential synchronization logic\",\"properties\":{}},{\"id\":\"block-41\",\"type\":\"numbered_list_item\",\"content\":\"4. **Learning Curve**: Teams need to understand the pattern and its implications\",\"properties\":{}},{\"id\":\"block-42\",\"type\":\"heading_2\",\"content\":\"CQRS and Event Sourcing\",\"properties\":{}},{\"id\":\"block-43\",\"type\":\"paragraph\",\"content\":\"CQRS is often paired with Event Sourcing, though they are separate patterns. Event Sourcing stores the complete history of all changes as a sequence of events, rather than just the current state. This combination is powerful but adds further complexity:\",\"properties\":{}},{\"id\":\"block-44\",\"type\":\"code\",\"content\":\"$12\",\"properties\":{\"language\":\"$undefined\"}},{\"id\":\"block-45\",\"type\":\"heading_2\",\"content\":\"Implementing CQRS Gradually\",\"properties\":{}},{\"id\":\"block-46\",\"type\":\"paragraph\",\"content\":\"You can adopt CQRS incrementally:\",\"properties\":{}},{\"id\":\"block-47\",\"type\":\"numbered_list_item\",\"content\":\"1. Start by separating command and query responsibilities in your service layer\",\"properties\":{}},{\"id\":\"block-48\",\"type\":\"numbered_list_item\",\"content\":\"2. Gradually introduce separate models for complex areas of your domain\",\"properties\":{}},{\"id\":\"block-49\",\"type\":\"numbered_list_item\",\"content\":\"3. Consider different data stores for the most performance-critical parts\",\"properties\":{}},{\"id\":\"block-50\",\"type\":\"numbered_list_item\",\"content\":\"4. Add event sourcing where historical data is valuable\",\"properties\":{}},{\"id\":\"block-51\",\"type\":\"heading_2\",\"content\":\"Conclusion\",\"properties\":{}},{\"id\":\"block-52\",\"type\":\"paragraph\",\"content\":\"CQRS is a powerful architectural pattern that provides significant benefits for complex, high-scale applications with different read and write requirements. While it introduces additional complexity, the separation of concerns allows for more targeted optimizations and greater flexibility in how you design and scale your system.\",\"properties\":{}},{\"id\":\"block-53\",\"type\":\"paragraph\",\"content\":\"As with any architectural pattern, CQRS should be applied thoughtfully and selectively based on your specific requirements, rather than as a default approach for all applications. When implemented correctly in the right context, it can significantly improve the scalability, maintainability, and performance of your software.\",\"properties\":{}}]}]}],[\"$\",\"div\",null,{\"className\":\"post-meta\",\"children\":[[\"$\",\"div\",null,{\"className\":\"post-date\",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar h-4 w-4\",\"children\":[[\"$\",\"rect\",\"eu3xkr\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\",\"ry\":\"2\"}],[\"$\",\"line\",\"m3sa8f\",{\"x1\":\"16\",\"x2\":\"16\",\"y1\":\"2\",\"y2\":\"6\"}],[\"$\",\"line\",\"18kwsl\",{\"x1\":\"8\",\"x2\":\"8\",\"y1\":\"2\",\"y2\":\"6\"}],[\"$\",\"line\",\"xt86sb\",{\"x1\":\"3\",\"x2\":\"21\",\"y1\":\"10\",\"y2\":\"10\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"April 24, 2025\"}]]}],[\"$\",\"div\",null,{\"className\":\"post-tags\",\"children\":[[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-tag h-4 w-4\",\"children\":[[\"$\",\"path\",\"14b2ls\",{\"d\":\"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z\"}],[\"$\",\"path\",\"7u93v4\",{\"d\":\"M7 7h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"className\":\"flex gap-2\",\"children\":[[\"$\",\"span\",\"event-sourcing\",{\"className\":\"post-tag\",\"children\":[\"#\",\"event-sourcing\"]}],[\"$\",\"span\",\"Microservices\",{\"className\":\"post-tag\",\"children\":[\"#\",\"Microservices\"]}],[\"$\",\"span\",\"cqrs\",{\"className\":\"post-tag\",\"children\":[\"#\",\"cqrs\"]}]]}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>
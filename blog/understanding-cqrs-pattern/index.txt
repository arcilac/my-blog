3:I[5613,[],""]
5:I[31778,[],""]
6:I[70269,["250","static/chunks/250-f66e98452b80d3d3.js","185","static/chunks/app/layout-240a9091c029d074.js"],"ThemeProvider"]
7:I[63186,["250","static/chunks/250-f66e98452b80d3d3.js","185","static/chunks/app/layout-240a9091c029d074.js"],""]
8:I[69148,["250","static/chunks/250-f66e98452b80d3d3.js","185","static/chunks/app/layout-240a9091c029d074.js"],""]
4:["slug","understanding-cqrs-pattern","d"]
0:["7MLt-QsY3h2HPlyVGsns6",[[["",{"children":["blog",{"children":[["slug","understanding-cqrs-pattern","d"],{"children":["__PAGE__?{\"slug\":\"understanding-cqrs-pattern\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","understanding-cqrs-pattern","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/my-blog/_next/static/css/b003d7fd4febd677.css","precedence":"next","crossOrigin":""}]]}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","link",null,{"rel":"icon","href":"/favicon.ico"}]]}],["$","body",null,{"className":"bg-black text-white min-h-screen flex flex-col","children":["$","$L6",null,{"defaultTheme":"dark","children":["$","div",null,{"className":"flex flex-col min-h-screen","children":[["$","$L7",null,{}],["$","div",null,{"className":"flex-grow","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}]}],["$","$L8",null,{}]]}]}]}]]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/my-blog/_next/static/css/83cc0ea6f102b864.css","precedence":"next","crossOrigin":""}]],"$L9"]]]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Blog"}],["$","meta","3",{"name":"description","content":"A personal blog connected with Notion"}],["$","link","4",{"rel":"icon","href":"/my-blog/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
1:null
a:I[74366,["749","static/chunks/749-a3c26f84645c186f.js","248","static/chunks/248-82e084d1ab311f08.js","308","static/chunks/app/blog/%5Bslug%5D/page-c62c6cb5e065a81b.js"],"NotionRenderer"]
b:T42b,```typescript
`
// Command Side
interface ICommandHandler<TCommand> {
  handle(command: TCommand): Promise<void>;
}

class CreateUserCommand {
  constructor(public readonly username: string, public readonly email: string) {}
}

class CreateUserCommandHandler implements ICommandHandler<CreateUserCommand> {
  constructor(private userWriteRepository: UserWriteRepository) {}

  async handle(command: CreateUserCommand): Promise<void> {
    const user = new User(command.username, command.email);
    await this.userWriteRepository.save(user);
    // Could also publish an event here
  }
}

// Query Side
interface IQueryHandler<TQuery, TResult> {
  handle(query: TQuery): Promise<TResult>;
}

class GetUserByIdQuery {
  constructor(public readonly userId: string) {}
}

class GetUserByIdQueryHandler implements IQueryHandler<GetUserByIdQuery, UserReadModel> {
  constructor(private userReadRepository: UserReadRepository) {}

  async handle(query: GetUserByIdQuery): Promise<UserReadModel> {
    return await this.userReadRepository.findById(query.userId);
  }
}
`
```c:T53f,```typescript
`
// Command side (using a relational database)
class UserWriteRepository {
  constructor(private dbConnection: SqlConnection) {}

  async save(user: User): Promise<void> {
    await this.dbConnection.execute(
      'INSERT INTO users (id, username, email, created_at) VALUES (?, ?, ?, ?)',
      [user.id, user.username, user.email, user.createdAt]
    );

    // Publish an event for the read side
    await this.eventBus.publish(new UserCreatedEvent(user));
  }
}

// Query side (using a document database optimized for reads)
class UserReadRepository {
  constructor(private documentDb: DocumentDbClient) {}

  async findById(userId: string): Promise<UserReadModel> {
    return await this.documentDb.collection('users').findOne({ id: userId });
  }

  async findByUsername(username: string): Promise<UserReadModel> {
    return await this.documentDb.collection('users').findOne({ username });
  }
}

// Event handler to keep read model updated
class UserCreatedEventHandler {
  constructor(private documentDb: DocumentDbClient) {}

  async handle(event: UserCreatedEvent): Promise<void> {
    const userReadModel = new UserReadModel(
      event.user.id,
      event.user.username,
      event.user.email,
      event.user.createdAt
    );

    await this.documentDb.collection('users').insertOne(userReadModel);
  }
}
`
```d:T65f,```typescript
`
// Event Sourcing with CQRS
class UserAggregate {
  private events: DomainEvent[] = [];
  private state: UserState = new UserState();

  createUser(username: string, email: string): void {
    // Business logic validation
    if (!this.isValidEmail(email)) {
      throw new Error('Invalid email');
    }

    // Apply the event
    this.applyEvent(new UserCreatedEvent(uuidv4(), username, email, new Date()));
  }

  private applyEvent(event: DomainEvent): void {
    this.events.push(event);
    this.state = this.state.apply(event);
  }

  getUncommittedEvents(): DomainEvent[] {
    return [...this.events];
  }

  private isValidEmail(email: string): boolean {
    // Email validation logic
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }
}

// Event Store
class EventStore {
  async saveEvents(aggregateId: string, events: DomainEvent[], expectedVersion: number): Promise<void> {
    // Save events with optimistic concurrency check
  }

  async getEvents(aggregateId: string): Promise<DomainEvent[]> {
    // Retrieve all events for an aggregate
  }
}

// Read Model Projector
class UserProjector {
  constructor(private readDb: DocumentDbClient) {}

  async project(event: DomainEvent): Promise<void> {
    if (event instanceof UserCreatedEvent) {
      await this.handleUserCreated(event);
    }
    // Handle other event types
  }

  private async handleUserCreated(event: UserCreatedEvent): Promise<void> {
    await this.readDb.collection('users').insertOne({
      id: event.userId,
      username: event.username,
      email: event.email,
      createdAt: event.timestamp
    });
  }
}
`
```2:["$","main",null,{"className":"post-container","children":["$","article",null,{"className":"post-article","children":[null,["$","h1",null,{"className":"post-title","children":"Understanding CQRS"}],["$","div",null,{"className":"post-content","children":["$","$La",null,{"blocks":[{"id":"block-0","type":"heading_1","content":"Command Query Responsibility Segregation","properties":{}},{"id":"block-1","type":"paragraph","content":"Command Query Responsibility Segregation (CQRS) is an architectural pattern that separates read and write operations for a data store. This pattern, introduced by Greg Young, builds upon the concept of Command-Query Separation (CQS) proposed by Bertrand Meyer, but takes it a step further by potentially using separate data models for reading and writing.","properties":{}},{"id":"block-2","type":"heading_2","content":"What is CQRS?","properties":{}},{"id":"block-3","type":"paragraph","content":"At its core, CQRS divides an application's operations into two categories:","properties":{}},{"id":"block-4","type":"bulleted_list_item","content":"- **Commands**: Operations that change state (create, update, delete)","properties":{}},{"id":"block-5","type":"bulleted_list_item","content":"- **Queries**: Operations that return data without changing state (read)","properties":{}},{"id":"block-6","type":"paragraph","content":"In traditional architectures, the same data model is used for both reading and writing operations. CQRS challenges this approach by suggesting that these operations can be separated, optimized independently, and potentially use different data models or even different data stores.","properties":{}},{"id":"block-7","type":"heading_2","content":"Key Principles of CQRS","properties":{}},{"id":"block-8","type":"numbered_list_item","content":"1. **Separation of Concerns**: Read and write responsibilities are handled by different components","properties":{}},{"id":"block-9","type":"numbered_list_item","content":"2. **Different Models**: Commands and queries can use different data models optimized for their specific needs","properties":{}},{"id":"block-10","type":"numbered_list_item","content":"3. **Eventual Consistency**: The read model may be eventually consistent with the write model","properties":{}},{"id":"block-11","type":"numbered_list_item","content":"4. **Scalability**: Read and write sides can be scaled independently based on their different requirements","properties":{}},{"id":"block-12","type":"heading_2","content":"Basic CQRS Structure","properties":{}},{"id":"block-13","type":"paragraph","content":"A basic CQRS implementation might look like this:","properties":{}},{"id":"block-14","type":"code","content":"$b","properties":{"language":"$undefined"}},{"id":"block-15","type":"heading_2","content":"CQRS with Different Data Stores","properties":{}},{"id":"block-16","type":"paragraph","content":"One of the more advanced implementations of CQRS involves using different data stores for reading and writing:","properties":{}},{"id":"block-17","type":"code","content":"$c","properties":{"language":"$undefined"}},{"id":"block-18","type":"heading_2","content":"When to Use CQRS","properties":{}},{"id":"block-19","type":"paragraph","content":"CQRS is particularly beneficial in the following scenarios:","properties":{}},{"id":"block-20","type":"numbered_list_item","content":"1. **Complex domains** with sophisticated business rules","properties":{}},{"id":"block-21","type":"numbered_list_item","content":"2. **High-performance applications** with different scaling needs for reads and writes","properties":{}},{"id":"block-22","type":"numbered_list_item","content":"3. **Collaborative domains** where multiple users might update the same data","properties":{}},{"id":"block-23","type":"numbered_list_item","content":"4. **Event-driven architectures** and systems that need to maintain an audit log","properties":{}},{"id":"block-24","type":"numbered_list_item","content":"5. **Microservice architectures** where different services have different data requirements","properties":{}},{"id":"block-25","type":"heading_2","content":"When Not to Use CQRS","properties":{}},{"id":"block-26","type":"paragraph","content":"CQRS isn't always the right choice:","properties":{}},{"id":"block-27","type":"numbered_list_item","content":"1. **Simple CRUD applications** where the complexity overhead isn't justified","properties":{}},{"id":"block-28","type":"numbered_list_item","content":"2. **Small applications** with limited domain complexity","properties":{}},{"id":"block-29","type":"numbered_list_item","content":"3. **Applications where read and write loads are balanced** and don't require separate scaling","properties":{}},{"id":"block-30","type":"numbered_list_item","content":"4. **Teams new to the pattern** without experience handling eventual consistency","properties":{}},{"id":"block-31","type":"heading_2","content":"Benefits of CQRS","properties":{}},{"id":"block-32","type":"numbered_list_item","content":"1. **Optimized Data Models**: Each side can use a data model optimized for its specific needs","properties":{}},{"id":"block-33","type":"numbered_list_item","content":"2. **Independent Scaling**: Read and write operations can be scaled independently","properties":{}},{"id":"block-34","type":"numbered_list_item","content":"3. **Security**: Finer control over access permissions for read vs. write operations","properties":{}},{"id":"block-35","type":"numbered_list_item","content":"4. **Performance**: Read models can be denormalized for optimal query performance","properties":{}},{"id":"block-36","type":"numbered_list_item","content":"5. **Flexibility**: Freedom to use different technologies for each side","properties":{}},{"id":"block-37","type":"heading_2","content":"Challenges of CQRS","properties":{}},{"id":"block-38","type":"numbered_list_item","content":"1. **Complexity**: Introduces more moving parts and complexity","properties":{}},{"id":"block-39","type":"numbered_list_item","content":"2. **Eventual Consistency**: The read model may lag behind the write model","properties":{}},{"id":"block-40","type":"numbered_list_item","content":"3. **Development Overhead**: Requires maintaining multiple models and potential synchronization logic","properties":{}},{"id":"block-41","type":"numbered_list_item","content":"4. **Learning Curve**: Teams need to understand the pattern and its implications","properties":{}},{"id":"block-42","type":"heading_2","content":"CQRS and Event Sourcing","properties":{}},{"id":"block-43","type":"paragraph","content":"CQRS is often paired with Event Sourcing, though they are separate patterns. Event Sourcing stores the complete history of all changes as a sequence of events, rather than just the current state. This combination is powerful but adds further complexity:","properties":{}},{"id":"block-44","type":"code","content":"$d","properties":{"language":"$undefined"}},{"id":"block-45","type":"heading_2","content":"Implementing CQRS Gradually","properties":{}},{"id":"block-46","type":"paragraph","content":"You can adopt CQRS incrementally:","properties":{}},{"id":"block-47","type":"numbered_list_item","content":"1. Start by separating command and query responsibilities in your service layer","properties":{}},{"id":"block-48","type":"numbered_list_item","content":"2. Gradually introduce separate models for complex areas of your domain","properties":{}},{"id":"block-49","type":"numbered_list_item","content":"3. Consider different data stores for the most performance-critical parts","properties":{}},{"id":"block-50","type":"numbered_list_item","content":"4. Add event sourcing where historical data is valuable","properties":{}},{"id":"block-51","type":"heading_2","content":"Conclusion","properties":{}},{"id":"block-52","type":"paragraph","content":"CQRS is a powerful architectural pattern that provides significant benefits for complex, high-scale applications with different read and write requirements. While it introduces additional complexity, the separation of concerns allows for more targeted optimizations and greater flexibility in how you design and scale your system.","properties":{}},{"id":"block-53","type":"paragraph","content":"As with any architectural pattern, CQRS should be applied thoughtfully and selectively based on your specific requirements, rather than as a default approach for all applications. When implemented correctly in the right context, it can significantly improve the scalability, maintainability, and performance of your software.","properties":{}}]}]}],["$","div",null,{"className":"post-meta","children":[["$","div",null,{"className":"post-date","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-calendar h-4 w-4","children":[["$","rect","eu3xkr",{"width":"18","height":"18","x":"3","y":"4","rx":"2","ry":"2"}],["$","line","m3sa8f",{"x1":"16","x2":"16","y1":"2","y2":"6"}],["$","line","18kwsl",{"x1":"8","x2":"8","y1":"2","y2":"6"}],["$","line","xt86sb",{"x1":"3","x2":"21","y1":"10","y2":"10"}],"$undefined"]}],["$","span",null,{"children":"April 24, 2025"}]]}],["$","div",null,{"className":"post-tags","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-tag h-4 w-4","children":[["$","path","14b2ls",{"d":"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"}],["$","path","7u93v4",{"d":"M7 7h.01"}],"$undefined"]}],["$","div",null,{"className":"flex gap-2","children":[["$","span","event-sourcing",{"className":"post-tag","children":["#","event-sourcing"]}],["$","span","Microservices",{"className":"post-tag","children":["#","Microservices"]}],["$","span","cqrs",{"className":"post-tag","children":["#","cqrs"]}]]}]]}]]}]]}]}]
